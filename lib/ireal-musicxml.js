(()=>{var e={308:function(e,t){var n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,void 0===(r="function"==typeof(n=function(e){"use strict";function t(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.toXML=void 0;var i="boolean",c="date",u="special-object",l=["_selfCloseTag","_attrs"],f=new RegExp(l.join("|"),"g"),p=function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").repeat(e)},h=function(e){return(Array.isArray(e)?"array":"object"===s(e)&&null!==e&&e._name&&u)||e instanceof Date&&c||null===e&&"null"||s(e)},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof e)return e;var n=new RegExp("(".concat(Object.keys(t).join("|"),")(?!(\\w|#)*;)"),"g");return String(e).replace(n,(function(e,n){return t[n]||""}))},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return Array.isArray(e)?e.map((function(e){var n=Object.keys(e)[0],r=e[n],o=t?b(r,t):r,a=!0===o?"":'="'.concat(o,'"');return"".concat(n).concat(a)})):Object.keys(e).map((function(n){var r=t?b(e[n],t):e[n],o=!0===e[n]?"":'="'.concat(r,'"');return"".concat(n).concat(o)}))},d=function(){var e=v(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0);if(0===e.length)return"";var t=e.join(" ");return" ".concat(t)},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).map((function(t){return{_name:t,_content:e[t]}}))},y=["string","number",i],g=function(e){return y.includes(h(e))},_=[].concat(y,[c,u]),w=function(e){return _.includes(h(e))},j=function(e){return!e.match("<")},O=function(e){var t=e.header,n=e.indent,r=e.isOutputStart;if(!t||!r)return"";var o=s(t)===i;return"".concat(o?'<?xml version="1.0" encoding="UTF-8"?>':t).concat(n?"\n":"")},k={"<":"&lt;",">":"&gt;","&":"&amp;"},x=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.depth,c=void 0===a?0:a,u=r.indent,v=r._isFirstItem,y=r.header,_=r.attributesFilter,x=void 0===_?{}:_,S=r.filter,P=void 0===S?{}:S,A="boolean"!=typeof x||x?o(o(o({},k),{'"':"&quot;"}),x):{},T="boolean"!=typeof P||P?o(o({},k),P):{},C=p(u,c),E=h(n),D=w(n),L=0===c&&(D||!D&&v),I="";switch(E){case"special-object":var M=n._name,R=n._content;if(null===R){I=M;break}if(Array.isArray(R)&&R.every(g))return R.map((function(t){return e({_name:M,_content:t},o(o({},r),{},{depth:c}))})).join("");if(M.match(f))break;var F=e(R,o(o({},r),{},{depth:c+1})),X=h(F),U=j(F),Z="".concat(u&&!L?"\n":"").concat(C),G="undefined"===X||""===F,N=s(n._selfCloseTag)===i?G&&n._selfCloseTag:G,z=N?"/":"",K=d(n._attrs,A),Q="<".concat(M).concat(K).concat(z,">"),W=u&&!U?"\n".concat(C):"",Y=N?"":"".concat(F).concat(W,"</").concat(M,">");I="".concat(Z).concat(Q).concat(Y);break;case"object":var q=Object.keys(n),B=q.map((function(a,s){var i=o(o({},r),{},{_isFirstItem:0===s,_isLastItem:s+1===q.length}),c={_name:a};if("object"===h(n[a])&&(l.forEach((function(e){var t=n[a][e];void 0!==t&&(c[e]=t,delete n[a][e])})),void 0!==n[a]._content&&Object.keys(n[a]).length>1)){var u=Object.assign({},n[a]);delete u._content,c._content=[].concat(t(m(u)),[n[a]._content])}return void 0===c._content&&(c._content=n[a]),e(c,i,a)}),r),$=u&&0===c?"\n":"";I=B.join($);break;case"function":var H=n(r);I=e(H,r);break;case"array":var J=n.map((function(t,a){var s=o(o({},r),{},{_isFirstItem:0===a,_isLastItem:a+1===n.length});return e(t,s)})),V=u&&0===c?"\n":"";I=J.join(V);break;default:I=b(n,T)}var ee=O({header:y,indent:u,depth:c,isOutputStart:L});return"".concat(ee).concat(I)};e.toXML=x;var S={toXML:x};e.default=S})?n.apply(t,[t]):n)||(e.exports=r)}},t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function e(){r(this,e),this.annots=[],this.comments=[],this.bars="",this.spacer=0,this.chord=null},a=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;r(this,e),this.note=t,this.modifiers=n,this.over=o,this.alternate=a},s=function(){function t(e){if(r(this,t),this.cells=[],!e)return this.title="",this.composer="",this.style="",this.key="",this.transpose=0,this.exStyle="",this.bpm=0,this.repeats=0,void(this.music="");var n=e.split("=");this.title=n[0].trim(),this.composer=this.parseComposer(n[1].trim()),this.style=n[3].trim(),this.key=n[4],this.transpose=+n[5]||0,this.exStyle=n[7],this.bpm=+n[8],this.repeats=+n[9]||3;var o=n[6].split("1r34LbKcu7");this.music=this.unscramble(o[1]),this.cells=this.parse()}var n,s;return n=t,(s=[{key:"parse",value:function(){for(var e=this.music.trim(),n=[];e;){for(var r=!1,o=0;o<t.regExps.length;o++){var s=t.regExps[o].exec(e);if(s){r=!0,s.length<=2?(n.push(s[0]),e=e.substr(s[0].length)):(n.push(s),e=e.substr(s[0].length));break}}r||(","!==e[0]&&n.push(e[0]),e=e.substr(1))}for(var i=[],c=this.newCell(i),u=null,l=0;l<n.length;l++){var f=n[l];switch(f instanceof Array&&(c.chord=this.parseChord(f),f=" "),f[0]){case"{":case"[":c.bars=f,f=null;break;case"|":u&&(u.bars+=")",u=null),c.bars="(",f=null;break;case"]":case"}":case"Z":u&&(u.bars+=f,u=null),f=null;break;case"n":c.chord=new a(f[0]);break;case",":f=null;break;case"S":case"T":case"Q":case"N":case"U":case"s":case"l":case"f":case"*":c.annots.push(f),f=null;break;case"Y":c.spacer++,f=null,u=null;break;case"r":case"x":case"W":c.chord=new a(f);break;case"<":f=f.substr(1,f.length-2),c.comments.push(f),f=null}f&&l<n.length-1&&(u=c,c=this.newCell(i))}return i}},{key:"parseComposer",value:function(e){var t=e.split(/(\s+)/);return 3==t.length?t[2]+t[1]+t[0]:e}},{key:"parseChord",value:function(e){var n=e[1]||" ",r=e[2]||"",o=e[3]||"";o&&(r+=o.substr(1,o.length-2));var s=e[4]||"";"/"===s[0]&&(s=s.substr(1));var i=e[5]||null;if(i&&(e=t.chordRegex.exec(i.substr(1,i.length-2)),i=e?this.parseChord(e):null)," "===n&&!i&&!s)return null;if(s){var c="#"===s[1]||"b"===s[1]?2:1;s=new a(s.substr(0,c),s.substr(c),null,null)}else s=null;return r=r.replace(/b/g,"♭").replace(/#/g,"♯"),new a(n,r,s,i)}},{key:"newCell",value:function(e){var t=new o;return e.push(t),t}},{key:"unscramble",value:function(e){for(var t,n="";e.length>51;)t=e.substring(0,50),e=e.substring(50),n+=this.obfusc50(t);return(n+=e).replace(/Kcl/g,"| x").replace(/LZ/g," |").replace(/XyQ/g,"   ")}},{key:"obfusc50",value:function(e){for(var t=e.split(""),n=0;n<5;n++)t[49-n]=e[n],t[n]=e[49-n];for(var r=10;r<24;r++)t[49-r]=e[r],t[r]=e[49-r];return t.join("")}}])&&e(n.prototype,s),t}();t(s,"chordRegex",/^([A-G][b#]?)((?:sus|alt|add|[+\-^\dhob#])*)(\*.+?\*)*(\/[A-G][#b]?)?(\(.*?\))?/),t(s,"chordRegex2",/^([ Wp])()()(\/[A-G][#b]?)?(\(.*?\))?/),t(s,"regExps",[/^\*[a-zA-Z]/,/^T\d\d/,/^N./,/^<.*?>/,s.chordRegex,s.chordRegex2]);var i,c,u,l=n(308);function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}u={divisions:768,notehead:"slash"},(c="defaultOptions")in(i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.song=t,this.options=n,this.musicxml=(0,l.toXML)(this.convert(),{header:'\n<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE score-partwise PUBLIC "-//Recordare//DTD MusicXML 3.1 Partwise//EN" "http://www.musicxml.org/dtds/partwise.dtd">\n      '.trim(),indent:"  "})}return p(e,null,[{key:"convert",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Object.assign({},this.defaultOptions,n);return new e(t,r).musicxml}}]),p(e,[{key:"convert",value:function(){return{"score-partwise":[{"movement-title":this.song.title},{identification:[{_name:"creator",_attrs:{type:"composer"},_content:this.song.composer},{_name:"creator",_attrs:{type:"lyricist"},_content:this.song.style},{encoding:[{software:"@infojunkie/ireal-musicxml"},{"encoding-date":this.convertDate(new Date)},{_name:"supports",_attrs:{element:"accidental",type:"no"}},{_name:"supports",_attrs:{element:"transpose",type:"no"}},{_name:"supports",_attrs:{attribute:"new-page",element:"print",type:"yes",value:"yes"}},{_name:"supports",_attrs:{attribute:"new-system",element:"print",type:"yes",value:"yes"}}]}]},{"part-list":{_name:"score-part",_attrs:{id:"P1"},_content:{_name:"part-name",_attrs:{"print-object":"no"},_content:"Lead sheet"}}},{_name:"part",_attrs:{id:"P1"},_content:this.convertMeasures()}]}}},{key:"convertDate",value:function(e){return new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().split("T")[0]}},{key:"convertMeasures",value:function(){var e=this,t=null,n=null;return this.song.cells.reduce((function(r,o){return console.log(o),o.bars.match(/(\(|\{|\[)/)&&(n=[],t={_name:"measure",_attrs:{number:r.length+1},_content:[]},r.length||n.push({divisions:e.options.divisions})),t&&o.bars.match(/(\)|\}|\]|Z)/)&&(n.length&&t._content.push({attributes:n}),t._content.length||delete t._content,r.push(t),t=null,n=null),r}),[])}}]),e}())?Object.defineProperty(i,c,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[c]=u})()})();